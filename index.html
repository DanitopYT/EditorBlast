<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Editor Blast</title>
    <style>
        :root {
            --bg: #0f172a;
            --grid-bg: #1e293b;
            --border: #334155;
            --block: #3b82f6;
            --indestructible: #64748b;
            --reward: #f59e0b;
            --eraser: #ef4444;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column;
            align-items: center; height: 100vh; overflow: hidden;
        }

        /* --- Header --- */
        .header { 
            width: 100%; padding: 15px; text-align: center; 
            background: #1e293b; font-size: 1.2rem; font-weight: 800;
            border-bottom: 3px solid var(--block);
            letter-spacing: 1px;
        }

        /* --- Grid --- */
        #game-container {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; width: 100%;
        }

        #grid {
            display: grid; gap: 4px; background: var(--border);
            padding: 8px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .cell {
            width: 38px; height: 38px; background: var(--grid-bg);
            border-radius: 6px; transition: all 0.15s ease;
        }

        /* Tipos de Bloques */
        .cell.block { background: var(--block); box-shadow: inset 0 0 12px rgba(255,255,255,0.2); }
        .cell.indestructible { 
            background: var(--indestructible); 
            border: 2px solid #94a3b8;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.1) 5px, rgba(0,0,0,0.1) 10px);
        }
        .cell.reward { 
            background: var(--reward); 
            box-shadow: 0 0 15px var(--reward);
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse { from { transform: scale(0.95); } to { transform: scale(1.05); } }

        /* --- UI de Piezas (Juego) --- */
        #pieces-area {
            height: 130px; display: flex; gap: 15px;
            align-items: center; justify-content: center; width: 100%;
            background: rgba(0,0,0,0.3); border-top: 1px solid #334155;
        }

        .piece-preview {
            display: grid; gap: 2px; cursor: pointer;
            padding: 8px; border: 2px solid transparent;
            border-radius: 8px; background: rgba(255,255,255,0.05);
        }

        /* --- Controles --- */
        .controls {
            width: 100%; background: #1e293b; padding: 15px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            box-sizing: border-box;
        }

        button {
            padding: 12px 5px; border: none; border-radius: 8px;
            background: #334155; color: white; font-weight: bold;
            font-size: 11px; text-transform: uppercase;
        }

        button.active { background: var(--block); outline: 2px solid white; }
        button.eraser-btn.active { background: var(--eraser); }
        
        .play-btn { 
            background: #10b981; grid-column: span 4; 
            font-size: 14px; margin-top: 5px;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="header" id="status">EDITOR BLAST: DISE√ëO</div>

<div id="game-container">
    <div id="grid"></div>
    
    <div id="pieces-area" class="hidden">
        </div>
</div>

<div class="controls" id="editor-ui">
    <button onclick="setTool('block')" id="tool-block" class="active">Bloque</button>
    <button onclick="setTool('indestructible')" id="tool-indestructible">Pared</button>
    <button onclick="setTool('reward')" id="tool-reward">Regalo</button>
    <button onclick="setTool('empty')" id="tool-empty" class="eraser-btn">Borrador</button>
    
    <div style="grid-column: span 4; display: flex; align-items: center; gap: 10px; padding: 5px 0;">
        <span>Columnas:</span>
        <input type="range" id="width-range" min="4" max="9" value="8" style="flex-grow:1">
        <span id="w-val">8</span>
    </div>
    
    <button class="play-btn" onclick="toggleMode()">‚ñ∂ PROBAR NIVEL</button>
</div>

<div class="controls hidden" id="game-ui">
    <button class="play-btn" style="background: #ef4444;" onclick="toggleMode()">‚úç VOLVER AL EDITOR</button>
    <div style="grid-column: span 4; text-align: center; font-size: 12px; color: #94a3b8;">
        1. Toca una pieza &nbsp; 2. Toca el tablero
    </div>
</div>

<script>
    let isPlaying = false;
    let currentTool = 'block';
    let gridW = 8;
    let gridH = 9;
    let levelData = Array(gridW * gridH).fill(null);
    let selectedPiece = null;

    const PIECES = [
        [[1,1], [1,1]], // Cuadrado
        [[1,1,1,1]],    // L√≠nea larga
        [[1,1,1]],      // Barra corta
        [[1,0],[1,0],[1,1]], // L
        [[0,1],[1,1],[1,0]], // Z
        [[1]]           // Punto
    ];

    const gridEl = document.getElementById('grid');

    function initGrid() {
        gridEl.innerHTML = '';
        gridEl.style.gridTemplateColumns = `repeat(${gridW}, 38px)`;
        
        for (let i = 0; i < gridW * gridH; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.index = i;
            cell.onclick = () => handleCellClick(i);
            gridEl.appendChild(cell);
        }
        renderLevel();
    }

    function renderLevel() {
        const cells = document.querySelectorAll('.cell');
        cells.forEach((cell, i) => {
            cell.className = 'cell ' + (levelData[i] || '');
        });
    }

    function handleCellClick(index) {
        if (!isPlaying) {
            // L√≥gica Borrador y herramientas
            levelData[index] = (currentTool === 'empty') ? null : currentTool;
            renderLevel();
        } else if (selectedPiece) {
            placePiece(index);
        }
    }

    function setTool(tool) {
        currentTool = tool;
        document.querySelectorAll('#editor-ui button').forEach(b => b.classList.remove('active'));
        document.getElementById('tool-' + tool).classList.add('active');
    }

    function toggleMode() {
        isPlaying = !isPlaying;
        document.getElementById('editor-ui').classList.toggle('hidden');
        document.getElementById('game-ui').classList.toggle('hidden');
        document.getElementById('pieces-area').classList.toggle('hidden');
        document.getElementById('status').innerText = isPlaying ? "EDITOR BLAST: JUGANDO" : "EDITOR BLAST: DISE√ëO";
        
        if (isPlaying) {
            spawnPieces();
        } else {
            renderLevel();
        }
    }

    // --- LOGICA DE JUEGO ---

    function spawnPieces() {
        const area = document.getElementById('pieces-area');
        area.innerHTML = '';
        for (let i = 0; i < 3; i++) {
            const piece = PIECES[Math.floor(Math.random() * PIECES.length)];
            const container = document.createElement('div');
            container.className = 'piece-preview';
            container.style.gridTemplateColumns = `repeat(${piece[0].length}, 15px)`;
            
            piece.forEach(row => row.forEach(v => {
                const div = document.createElement('div');
                div.style.width = '15px'; div.style.height = '15px';
                div.style.background = v ? 'var(--block)' : 'transparent';
                container.appendChild(div);
            }));

            container.onclick = () => {
                selectedPiece = piece;
                document.querySelectorAll('.piece-preview').forEach(p => p.style.borderColor = 'transparent');
                container.style.borderColor = 'white';
            };
            area.appendChild(container);
        }
    }

    function placePiece(index) {
        const r = Math.floor(index / gridW);
        const c = index % gridW;

        for(let pr=0; pr<selectedPiece.length; pr++){
            for(let pc=0; pc<selectedPiece[0].length; pc++){
                if(selectedPiece[pr][pc]){
                    let targetIdx = (r + pr) * gridW + (c + pc);
                    if(c + pc >= gridW || r + pr >= gridH || levelData[targetIdx]) return;
                }
            }
        }

        for(let pr=0; pr<selectedPiece.length; pr++){
            for(let pc=0; pc<selectedPiece[0].length; pc++){
                if(selectedPiece[pr][pc]) levelData[(r + pr) * gridW + (c + pc)] = 'block';
            }
        }
        
        selectedPiece = null;
        renderLevel();
        checkLines();
        spawnPieces();
    }

    function checkLines() {
        // Filas
        for (let r = 0; r < gridH; r++) {
            let rowIdxs = [];
            for (let c = 0; c < gridW; c++) rowIdxs.push(r * gridW + c);
            if (rowIdxs.every(idx => levelData[idx])) clearLine(rowIdxs);
        }
        // Columnas
        for (let c = 0; c < gridW; c++) {
            let colIdxs = [];
            for (let r = 0; r < gridH; r++) colIdxs.push(r * gridW + c);
            if (colIdxs.every(idx => levelData[idx])) clearLine(colIdxs);
        }
    }

    function clearLine(idxs) {
        idxs.forEach(idx => {
            if (levelData[idx] !== 'indestructible') {
                if(levelData[idx] === 'reward') alert("üéÅ ¬°CAJA DE RECOMPENSA! Puntos x2");
                levelData[idx] = null;
            }
        });
        renderLevel();
    }

    document.getElementById('width-range').oninput = (e) => {
        gridW = parseInt(e.target.value);
        document.getElementById('w-val').innerText = gridW;
        levelData = Array(gridW * gridH).fill(null);
        initGrid();
    };

    initGrid();
</script>
</body>
</html>